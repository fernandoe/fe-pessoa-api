language: generic
sudo: required
services:
- docker

env:
  global:
  - secure: fCqdS0LNUJiBmGBl6KvvSo+UbAZmaKGMqsSV2NYA3Vem1IVpYoKhb2dBL1kRgaTvFiWWi+Nn4MMMrcF3T4BwYi0fCmZ3BAdt9YCivDWHI2d6IVPRHZq/17OkuUAsizAw+SUBTdmHd14HWvyiMTPttvuqSAFIvsVJVH9EYcK7qGWdm3mjCFFx1SRYp64+yGbCVEy2KZoKtwXP5OpxGPYgApGtb7kl7aMJQd0GLrJ8Az1vKNOn2vH94hzNRKRHmsbKsSNdFYyY+SYwcttj7JVVXMFk4j6/PaPKZIRXLy8uDBM2PfguK+E9A09jYvAp9ypq9hJYgpcvH9wcZTF7Nmqu3sdfrWJMj6vaxv2NVSfKlqa7aNp75uNBldc2ImR5zp0ZQ15M0jpSz1aqn5HPjghONNODvMreAqylVUo9+19nxWFbZNzcjZptYtSoY3Tn71Qx1QoL2VOG3mX4/8bE6zhixWbYleqJfN8FIctXBm/T4OWYQttRNFuirYU+1rWg3EvRWoAz0NYoAxlNZNr+jaNyxegF7boug1h7CjsD/mMmVj2QugVgkUmoP5zCbi5eJmDen51jQKW+SMLWlO5HMqVlP6xQ1icIaVNswmSo5s1UN9Er+UI4E0whtoxVkPmQnj8IT8FR95euxN35uMJRHq2tRL8usaE4IrKIOFsTcRJFAYc=
  - secure: kTK/eMzmc+a+hfAyUYGJ2HuKh8kRr1g9v9g0nwBCLvyj+UFEDQ/SyTif2GzPGXSvLG9doDcTzLSpGZkhcBITrnDAn4SxE6VijK4kI76joTmHrmcJq9DJnhyebHAC2SsIaS3u0+bhvgPFWg4bU4ZTE3ouJHlhsZ2CE4uUrjfC3cTAu7F1kdFvT5ktWIaTUnIx2pxF9kFH8bd/uHJ9zFuLmsOK8mvgvLifk21Y6hIjpfPOPRgeWxBoDc/hjE28/ifyQ3F+ZYyScVbwbAVjBWbLOvHQl2h3oW8QLLtwhApobsWpciOY4DetG2MBmWaiDqQUI7otOY8aBu4YQyC1fbKxbC7oOTPBYj1otLESaP6JUaGTORgt4fT/AgrCh0Wjg314e8e5T7qUcUKcVQGVlXG+3NY4l9KRKuNiV2+8FY7YEUV361r8S0JdxOcV8/YiNuV4peL9z29oaQSiAhq1m66OW5//H3PdWn8K7ZSq6G2L1gcGdkQO41Yoi+HkpkMWreuSPbolQqgXeGAloBURcxdCB3PqfryEaQd/1TphE+A4sgMmNN/IUX6O4qnXJI52olkLQ90eB2AJB30PUGhpu5AwJhajoRPaXNq0cYko6FK/CMBPq2VmjPgB2hF6vkEGqVpADHurKC65ogep6RbQFoL2ZKEUZj+XKeo/Py0bSPwhObE=
  - secure: DSsx4ZTSvSgCgUR3c2o6kLp3pE1O3+jCYpZmtG0p2Lrv+aRv7JUTJqoCHfcy6DNyVLiXwYvfG/Fr+ZiMzsNOhdeMyT34dVwuJzWluQjMBQPq94bt5KAu5o79Ytk695BLuSbs2U3T8KhUi4kVsEn/GBoJSz1quH7Y9cy60KuAEnBsdfRB2vgS5n2HPNcaac8/S58HmQfO58aGnRhIHgfVfRHEC4TYvPL1/12FtCQ8M9Vcpdelu8hJ+OMJT853RHw6HFiSWZE8kjt/sl+yrrb/wQvAhP7ZW8hSq5q8YuW/awoChritVu0qDJApwZqwG/ZGZGVaR/OJXxPU/jAVIFzUjP9FlUxQM8cMOy9sYx8MP8zkD85bw/595Do8c2M33AtJoQUywEuWQAUo/jFn3od/eRU3ek/gJRjuAukc9bO6SS7Jz1aiyEsVtt7ufU3+lCnGONA5lUzkJq2zpCuUUmjZb634yrCjW+oYyrsOZ89Es5eNtcBxpYrmjnzEb4zZMMK04727sBEyErqeOLbSAGz3ddtYKuW6bPj5dyb0x6XlWsnAQqshAc1AZeo8jtnqauILVNQ0Vp9OczeMaVzYAbNKCtZB7QrJslfhHvgTO8aYSRQJZwOw3ObkM+qMlWfGqjMHcvKn7FDSiwNtXUdX5Bn4h/vpv/dOFLtyeYTvHQKHsr0=
  - secure: wmJUmkfEJ8fcRAy1AA5hL4qbFkdvb7YidYupxfur+HMi4h96Kaw2bV2s2jLgYC26fmGGr8kD10SyfVBgQYFnrHyc3Nv3/4FDR58B1eCYwN6g9LQgMAvvaS01UYcwGYB2aZm38x1E0b/SQ2oHy2qSIgGfMb+U95icXzT7jBajl4axQ8CBTQqIFBpMPOZatWw0hXBVCu6hA4oMGxwEuZjQC0QmORzWNk3GTcgTaarbHXy2VbCEvEnjq3T/woodzTr1YwHGyiC39Wqum92Jo12B3yuiOKAV7xoXHIJA1AVuz5CraWXh77aqqZSPRoPuPUBngUL9solJKe8RJHXxbDYdVvQY4dhujauDFzu/vzhrRpkfH95UgYuAsOhlOzGusjt4U0MV5OylgkojOEN2zxdq8bOOst/XLIVCfWSbGw2ZhdC4bxmaY/wBrp1ygatF8FkwrobFvnwWubDCa2EGYf7IVrYRq5NFDShnc7+eXuKADJ12Zqx5YFvnktVGbYM/fzF9lm0S1F9MvdSmHvT0a6T7A4xq/f4Bfq5BpDufAveU1GFuEihvWq1+rHH4kC6i0+lJn3XbGd4ujRpiTWEU22CRXlJmULho9sfxQ1Ki4fDKAl7R/l5FORCA0YhorquRhkalAxtMNE2qLrVSoN4ruqT9dUZRB0x+RzBjXgqnE4+v8s4=
  - secure: ce+mFSh9owokreTE1FeZDIt1MvaJoYO0JstnuQ0LGBGRTsG+vJDrHUJTTiqF8T0O3tXpX3mP9qQVVUqWwP4jJzJP115TTLxvzfrlDJkrolHXcVWrVSMKhea4k1BtF/mN03X80a49vzMSR958H4YZdJxtcACnxRPcaxQ/wH34ae1hc/csFbIm3YFm1EfFXZVODdLCTpBFI/KXdeFbeJNyjZKec4DaBcDDOAkqRzEkjeUBY5ySYQ4oYJIOLZoJVA6YBu5duPTF8c0gnyZX1efewfLJk3Hjwldso0N8B12qo6uGbCy9qwzvA2Pz+yvZ19a5fJi8s9TMEBtv9MgnnW7dCCBZlBlZ4GjIypbUmu5Yxgahs9dm3xKymIHSXRKlIDHpqQHAmeLxRUyB0Gv0rFNDlzEb9uEB6maQgVLZKp8XcWEfIPe5ZjIWtJcXdIr8ha/b7EVDhs1pS/J81hp5rdxZ8/JOWiNSHzJcOjvyULWZGxQ/ssTYdr61BcYdYC21d2OkG/QqsIt/ox8EOBZG1leFVAayiCAj0l2cknUtdMRCadZQlgYjOMKJnP04vvnKwwm25lA+bJiyzb6ehHXWvf5ubaXY0H+IdlFckbncJADwz6ingboHkjUt2i38NjQg6wXeCzKae51Bmk1VGIxwiJjZumxOGLb9XCfnjQkhwGYP4f4=
  - secure: H/92s4yMvf6HS09mSg680+bt7FPzZxBMtpu2efrLLSoAMVelJ71a/VwZCVO03JRAjdNtvNBuIk92vKKdyrnyIVuaVEUwnUBjlnmukwDQkmYCXVC6SlWEp6Yk/FtroeTQctdEhWgrLaeFLL/QMhXRb0G0M4TnjJBt7ke6i3Y+iBuUzAOrVMib1pG3xOWH/PQsWX/ocP8HakIZMp7JYL7BjawYt5y6/0oN96+LOsjxoOZmxCIFZwKAH28uVb+EoH68PSnXFu6EqnKcqOd7t9ncn27fcfbnEkQgZeuh0mvyKKsXlZ0oX774lxMYnOiwaQj9RyRrRquPTfLSjEuiUiAPR8YeYpdLWroVSr62GdXyehzgKdbbqeGLYWHKb/eeWomcLrbo1M+imV3tVweBEjx7InUm+GxtP9mnBgtnQVYTRd6XlhACmeBhTY7rbElqum3SjaioaojEvAGO4YGN6+3HzLa99EkBCO/+EhZThwQs1U40DVat823rQg04TnNNhDUGVgKFkr6TGq7FyXkqSspF8h/w2HHaAGIViuM9SlWJ1ESOkAQNRyGb87ipxdSxIYei1lcGiqvQpRWCkKkalfgsZwYLYTMK829ywbr4Dno9u5j5laKvJK3WQtgPljJV4KLEiQfcQlFwmRFR1ZcwKts3UVs54VkgAgI68UUAjttvCRw=
  - secure: Kqb5QDhARwzR7/ezdz7AM0kasZu98Tf05ak702d8CbVvP8XkO1KBP8/+AxjXbAyRPZH5J0D/QXMEy01edUxG1cExA6CpV0rAWodHQLRp9/XYrQ7iKeXgWwdbeXFM/LNLJrNSwoQrCv9xWy7f1zeOwfzRLS816tKwNoqcVa82s1NGWya7rYoXVGnNT27nP4qg+h6p16wPcZvzYO8/+OUoRfMjGsYbfuzhftk7lfjnQFZc6C5FFSCMe2Cvw3nwXjHMKI6aZPAG/wFrvvdhWyCkBFLLidLgvFgiY3zM76Bz6gBADWygb6AWTHpUgUzn1VCpM1xGI90sz8x1L62b6FKs+y7gMF0st9s2gYEiM5arsKKkRxsAcQQh+PptfzmVbqCsLzQem6/p7WOPaqws+JZJ/Nm8AMmHCJIXZRpn9TChTBfHY60ad2uitjy2wtIAnNhEb5v1cCTzCcyFVh3fRHdMAdlVLmP/qmVoqcnMMXE5g4QyCIMyej70s7tlFSUMCEgNEPQfBztdFSSGzUl4oix8f89lWuAuwUjE0DIZBcXKHGIluQ3Bw0wOYlVdedOECnje+jvemJZutmFqL4kDYszVnwxP/QCT3MZ9JR/i45vnHaUwcqA1E1Oiq6PV5TYrJGloPdnRM2Wx7AFMIFms0xdvxiyG785OBOLefnm042Wn/3s=
  - secure: LpjBUJQnpyBslU2xpZcPJQ4nZ4LFb2szWnpX7+Fc9+tvj8W6iZwP3j85fDDJR0BkDLW2ZuSZ/fNoIVqbIZYg2KmGOBttl/L+fdFKZyzvcYjJ0CrLSTtCeevyfKgX0zPONWBtTAQGKkz/ZmndgRaw6W2INzx5LUNE90z8LPXeRwUFGucONG84zGqdcdXaBQxzfw5cVk6Bckkeg+caIEDsW7je2YWgXuuPNSVoVCfC+mEVLMQN3TafREY0Xgn2eT1es4VGOCsrD6dJZ5qISh2qbHzCBRqsajjGxVacwkZqY/PC4hBs7eygXkk2r3mRXvoINSue6o58epGnr7xXfZUT7SUlyYagefi1gIpYSbYgHjL5DiMmSbPlGqPsSbsNVyjYzR+BNA8M7enDGbgQe//+7E8YZv+UnSvKbuhlQEn6LRA4UxTzB9ttyZl45j2WLx6kjj2mjgZ0iEmHliK0kgDxG7qMZkPdc0ZJT8JBbPzjO4X53ZZnLU/Gaewo5Jq+P1qXuBQ0gH7JDB9hl6FK/dDzDgWKtXC4I9jqOgzP+DrVYqHHZIDJ0HAYSVwPia1oR2tQI0Np1FU8HLwbs59yxLHja7BB/w4zohc3uqN2DanN6cx4a8aZah9Kl5fbwXmVhXpo0czaANvO8rLnOezAYQMqniyYAOmE/PViqr7tCwNuz6o=

before_install:
- echo "$DOCKER_PASS" | docker login -u $DOCKER_USER --password-stdin

install:
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
- docker build -f Dockerfile -t $TRAVIS_REPO_SLUG:$TAG .

script:
- make travis.test

after_success:
- docker push $TRAVIS_REPO_SLUG

deploy:
  skip_cleanup: true
  provider: script
  script:
  - "./scripts/deploy.sh"
  on:
    tags: true
    branch:
    - master
    - "/(\\d+\\.)?(\\d+\\.)?(\\*|\\d+)$/"
